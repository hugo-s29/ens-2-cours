\documentclass[./main]{subfiles}

\begin{document}
  \selectlanguage{french}
  \setquotestyle{french}

  \chapter{Expressions $\omega$-régulières.}
  Cette partie du cours n'est pas dans les notes de cours mais la source est 
  \begin{center}
    \textit{Baier, C. and Katoen, J.-P., Principles of Model Checking, MIT Press, 2008}.
  \end{center}

  L'objet de cette section est l'analogue des expressions régulières pour les $\omega$-mots.

  Soit $\Sigma$ un alphabet non vide et fini.

  \begin{defn}[Quelques opérations]
    Soit $F$ une expression régulière sur $\Sigma$ telle que $\varepsilon \not\in \mathcal{L}(F)$. On pose
    \[
    \mathcal{L}(F)^\omega := \mleft\{\,\sigma \in \Sigma^\omega \;\middle|\; 
    \begin{array}{l}
      \sigma = v_1 \cdot v_2 \cdot v_3 \cdot \ldots\\
      \forall i \ge 1, v_i \in \mathcal{L}(F)
    \end{array}\,\mright\} 
    .\]
    Soit, de plus, $E$ une expression régulière sur $\Sigma$. On pose
    \[
    \mathcal{L}(E) \cdot \big(\mathcal{L}(F)\big)^\omega :=
    \mleft\{\,u \cdot \sigma \in \Sigma^\omega \;\middle|\;
    \begin{array}{l}
      u \in \mathcal{L}(E)\\
      \sigma \in \mathcal{L}(F)^\omega
    \end{array}\,\mright\} 
    .\]
    \textbf{Attention.} On peut avoir $u = \varepsilon \in \mathcal{L}(E)$.
  \end{defn}

  \begin{defn}
    Une \textit{expression $\omega$-régulière} sur $\Sigma$ est de la forme 
    \[
    G := E_1 \cdot F_1^\omega + \cdots + E_n F_n^\omega
    ,\] 
    où les $E_i, F_i$ soin des expressions régulières (classiques) sur $\Sigma$,\footnote{Il y a plusieurs grammaires pour décrire ces expressions mais elles sont toutes (généralement) équivalentes.}
    avec $\varepsilon \not\in \mathcal{L}(F_i) \subseteq \Sigma^\star$.

    Le \textit{langage} de $G$ est 
    \[
    \mathcal{L}_\omega(G) :=
    \mathcal{L}(E_1) \cdot \big(\mathcal{L}(F_1)\big)^\omega
    \cup \cdots \cup 
    \mathcal{L}(E_n) \cdot \big(\mathcal{L}(F_n)\big)^\omega
    \subseteq \Sigma^\omega
    .\]
  \end{defn}

  \begin{exm}
    Avec $\Sigma = \{a, b\}$, on a
    \[
    P := (b^\star a)^\omega (\equiv \{\varepsilon\} \cdot (b^\star a)^\omega \equiv (b^\star a) \cdot (b^\star a)^\omega)
    ,\]
    où l'on note $G \equiv G'$ quand $\mathcal{L}_\omega(G) = \mathcal{L}_\omega(G')$.

    On a que \[
      \mathcal{L}_\omega(P) = \{\sigma \in \Sigma^\omega  \mid \exists^\infty t,  \sigma(t) = a\} 
    .\]
  \end{exm}

  \begin{exm}
    Avec $\Sigma = \{a, b\}$ et $S := (a+b)^\star \cdot b^\omega$,
    on a 
    \[
    \mathcal{L}_\omega(S) = \{\sigma \in \Sigma^\omega  \mid \forall^\infty t, \sigma(t) = b\} 
    .\]
  \end{exm}


  \section{Automates de Büchi non-déterministes (NBA).}

  Avec ces NBA, on va définir une classe de langages équivalents aux expressions $\omega$-régulières.

  \begin{defn}
    Un \textit{NBA} est de la forme 
    \[
    \mathcal{A} = (Q, \Sigma, \delta, Q_0, F)
    ,\]
    où
    \begin{itemize}
      \item $Q$ est un ensemble \textit{\textbf{fini}} d'\textit{états} ;
      \item $\Sigma$ est l'alphabet d'entrée (non vide et fini) ;
      \item $\delta : Q \times \Sigma \to \wp(Q)$ est la \textit{fonction de transition} (non-déterministe) ;
      \item $Q_0 \subseteq Q$ est l'ensemble des \textit{états initiaux} ;
      \item $F \subseteq Q$ est l'ensemble des \textit{états acceptant}.
    \end{itemize}
  \end{defn}

  (C'est la même définition que les automates finis non-déterministes (NFA) mais la différence est que l'on va exécuter ces automates sur des $\omega$-mots, et on va donc modifier la définition d'\textit{acception}.)

  \begin{defn}
    Une \textit{exécution} de $\mathcal{A}$ sur $\sigma \in \Sigma^\omega$ est un $\rho \in Q^\omega$ tel que 
    \[
      \rho(0) \in Q_0 \quad\quad\text{et}\quad\quad\forall n \in \mathds{N} \quad \rho(n+1) \in \delta(\rho(n), \sigma(n))
    .\]
  \end{defn}

  \begin{rmk}
    L'ensemble 
    \[
    \{\rho \in Q^\omega  \mid \text{$\rho$ est une exécution de $\mathcal{A}$ sur $\sigma$}\} 
    \] 
    peut être non-dénombrable (par non déterminisme), et peut être vide.
  \end{rmk}

  \begin{defn}
    Une exécution $\rho$ de $\mathcal{A}$ sur $\sigma$ est \textit{acceptante} si
    \[
    \exists^\infty t, \quad \rho(t) \in F
    ,\]
    on visite infiniment souvent un état acceptant.
  \end{defn}

  \begin{rmk}
    Par le principe des tiroirs infinis (l'ensemble $Q$ est fini), une exécution $\rho$ est acceptante ssi il existe un état acceptant~$q \in F$ que l'on visite une infinité de fois :
    \[
    \exists q \in F, \quad \exists^\infty t \quad \rho(t) = q
    .\] 
  \end{rmk}

  \begin{defn}
    Le langage $\mathcal{L}_\omega(\mathcal{A})\footnote{L'indice $\omega$ est très important ici.} \subseteq \Sigma^\omega$ est défini par 
    \[
    \mathcal{L}_\omega(\mathcal{A}) :=
    \mleft\{\, \sigma\in \Sigma^\omega \;\middle|\; \exists \rho \in Q^\omega, 
    \begin{array}{l}
      \rho \text{ est une exécution}\\
      \text{acceptante de } \mathcal{A}
    \end{array}\,\mright\} 
    .\]
  \end{defn}

  \begin{rmk}
    La fonction caractéristique de $\mathcal{L}_\omega(\mathcal{A})$  :
    \begin{align*}
      \chi_{\mathcal{L}_\omega(\mathcal{A})}: \Sigma^\omega &\longrightarrow \{0,1\}  \\
      \sigma &\longmapsto \begin{cases}
        1 &\text{ si } \sigma \in \mathcal{L}_\omega(\mathcal{A})\\
        0 &\text{ sinon}.
      \end{cases}
    \end{align*}
  \end{rmk}

  \begin{prop}
    Étant donné un NBA $\mathcal{A}$, on peut tester si $\mathcal{L}_\omega(\mathcal{A}) = \emptyset$ en temps $\mathrm{O}(|Q| + |\text{transitions}|)$.
  \end{prop}
  \begin{prv}
    Il suffit de faire un DFS (c'est Tarjan-approved).
  \end{prv}

  \begin{exm}
    Avec $\Sigma = \{a, b\}$, on considère le NBA $\mathcal{P}$ défini comme
    \begin{figure}[H]
      \centering
      \begin{tikzpicture}
        \node[state,initial] (0) {};
        \node[state,right of=0, accepting] (1) {};

        \draw[->] (0) edge[bend left] node{$a$} (1)
        (1) edge[bend left] node{$b$} (0)
        (0) edge[loop above] node{$b$} (0)
        (1) edge[loop above] node{$a$} (1) ;
      \end{tikzpicture}
      \caption{Automate de Büchi non-déterministe $\mathcal{P}$}
    \end{figure}
    où l'on note avec une flèche entrante les états initiaux et avec un double cercle les états acceptants.
    On a $\mathcal{L}_\omega(\mathcal{P}) = \mathcal{L}_\omega(P)$.
  \end{exm}

  \begin{exm}
    On considère le NBA $\mathcal{S}$ défini comme 
    \begin{figure}[H]
      \centering
      \begin{tikzpicture}
        \node[state,initial] (0) {};
        \node[state,right of=0, accepting] (1) {};

        \draw[->] (0) edge node{$b$} (1)
        (0) edge[loop above] node{$a,b$} (0)
        (1) edge[loop above] node{$b$} (1) ;
      \end{tikzpicture}
      \caption{Automate de Büchi non-déterministe $\mathcal{S}$}
    \end{figure}
    On a $\mathcal{L}_\omega(\mathcal{S}) = \mathcal{L}_\omega(S)$.
  \end{exm}

  \begin{rmk}
    On note $\Pi^0_2$ l'ensemble des intersections dénombrables d'ouverts.
    On peut montrer que tout langage dans $\Pi^0_2$ peut s'écrire comme combinaison booléenne (union, intersection, complément) de langages comme $\mathcal{L}_\mathcal{w}(P)$.

    On note $\Sigma^0_2$ l'ensemble des unions dénombrables de fermés.
    On peut montrer que tout langage dans $\Sigma^0_2$ peut s'écrire comme combinaison booléenne (union, intersection, complément) de langages comme $\mathcal{L}_\mathcal{w}(S)$.
  \end{rmk}

  \begin{thm}
    Soit $\Sigma$ un alphabet non vide et fini.
    \begin{enumerate}
      \item Pour tout NBA $\mathcal{A}$ sur $\Sigma$, il existe une expression $\omega$-régulière~$G$ sur $\Sigma$ telle que $\mathcal{L}_\omega(G) = \mathcal{L}_\omega(\mathcal{A})$.
      \item Pour toute expression $\omega$-régulière $G$ sur $\Sigma$, il existe un NBA~$\mathcal{A}$ tel que $\mathcal{L}_\omega(\mathcal{A}) = \mathcal{L}_\omega(G)$.
    \end{enumerate}
    De plus, ces deux "il existe" sont \textit{constructifs}.
  \end{thm}
  \begin{prv}
    \begin{enumerate}
      \item Soit $\mathcal{A} = (Q, \Sigma, \delta, Q_0, F)$ un NBA.
        Pour tout~$p, q \in Q$, on note $\mathcal{A}_{p, q} = (Q, \Sigma, \delta, \{p\} , \{q\})$, et on a 
        \[
        \mathcal{L}_\omega(\mathcal{A}) = \bigcup_{p \in Q_0, q \in F} \mathcal{L}(\mathcal{A}_o, q) \cdot \big(\mathcal{L}(\mathcal{A}_{q, q}) \setminus \{\varepsilon\}\big)^\omega
        .\]
      \item On montre que :
        \begin{enumerate}
          \item Soient $\mathcal{A}, \mathcal{B}$ deux NBAs sur $\Sigma$. Il existe (constructif) un NBA $\mathcal{C}$ sur $\Sigma$ tel que 
            \[
            \mathcal{L}_\omega(\mathcal{C}) = \mathcal{L}_\omega(\mathcal{A}) \cup \mathcal{L}_\omega(\mathcal{B})
            .\]
          \item Soit $\mathcal{A}$ un NFA sur $\Sigma$ tel que $\varepsilon \not\in \mathcal{L}(\mathcal{A})$, il existe (constructif) un NBA $\mathcal{B}$ sur $\Sigma$ tel que 
            \[
              \mathcal{L}_\omega(\mathcal{B}) =\big(\mathcal{L}(\mathcal{A})\big)^\omega
            .\] 
          \item Soit $\mathcal{A}$ un NFA sur $\Sigma$ et $\mathcal{B}$ un NBA sur  $\Sigma$, il existe $\mathcal{C}$ un NBA sur $\Sigma$ tel que $\mathcal{L}_\omega(\mathcal{C}) = \mathcal{L}_\omega(\mathcal{A}) \cdot \mathcal{L}_\omega(\mathcal{B})$.
        \end{enumerate}
        On ne détaillera pas toute la preuve.
        \begin{enumerate}
          \item Il suffit de mettre les deux automates en parallèle (comme pour l'union disjointe de deux NFAs).
          \item Soit $\mathcal{A} = (Q, \Sigma, \delta, Q_0, F)$ un NFA tel que $\varepsilon \not\in \mathcal{L}(\mathcal{A})$.
            On peut supposer qu'il n'y a pas de transition vers $Q_0$ et que $Q_0 \cap F = \emptyset$.\footnote{On peut prendre $\mathcal{A}_\iota := (Q \sqcup \{\iota\}, \Sigma, \delta_\iota, \{\iota\}, F)$ avec $\delta_\iota(\iota, a) = \bigcup_{q \in Q_0} \delta(q, a)$ et $\delta_\iota(q, a) = \delta(q, a)$ pour $q \neq \iota$.
              On a $\mathcal{L}(\mathcal{A}_\iota) = \mathcal{L}(\mathcal{A})$ car $\varepsilon \not\in \mathcal{A}$.
            }
            On définit \[
            \mathcal{B} := (Q, \Sigma, \delta_\mathcal{B}, Q_0, Q_0)
            .\] 
            où 
            \[
            \delta_\mathcal{B}(q, a) := \begin{cases}
              \delta(q, a) & \text{ si } \delta(q, a) \cap F = \emptyset \\
              \delta(q, a) \cup Q_0 & \text{ sinon}.
            \end{cases}
            \]
            (Ce deuxième cas est important car on ne sais pas toujours le découpage du mot avant d'avoir considéré le mot en entier, ce qui demande de continuer l'exécution dans $\mathcal{A}$.)
          \item Il suffit de "mettre en série" $\mathcal{A}$ puis  $\mathcal{B}$ en connectant les acceptants de $\mathcal{B}$ avec les finaux de $\mathcal{A}$ (quitte à prendre $\mathcal{B}_\iota$).
        \end{enumerate}
    \end{enumerate}
  \end{prv}

  \begin{defn}
    Un langage $L \subseteq \Sigma^\omega$ est \textit{$\omega$-régulier} s'il existe un NBA $\mathcal{A}$ tel que  $L = \mathcal{L}_\omega(\mathcal{A})$.
  \end{defn}

  \begin{crlr}
    Si $L, K \subseteq \Sigma^\omega$ deux langages $\omega$-réguliers alors $L \cup K$ est $\omega$-régulier.
  \end{crlr}

  Dans la suite, on va voir la stabilité par intersections finies, mais on ne va pas voir de preuve du théorème ci-dessous.

  \begin{thm}[Büchi]
    Si $L \subseteq \Sigma^\omega$ est $\omega$-régulier alors $\Sigma^\omega \setminus L$ est $\omega$-régulier.
  \end{thm}
  \begin{prv}
    On l'admet (il n'est pas nécessaire pour le lien avec les formules $\mathsf{LTL}$).
  \end{prv}

  \section{Automates de Büchi déterministes (DBA).}

  \begin{defn}
    Un NBA $\mathcal{A} = (Q, \Sigma, \delta, Q_0, F)$ est \textit{déterministe} si
    \begin{itemize}
      \item $|Q_0| \le 1$
      \item $\forall q \in Q, \forall a \in \Sigma, |\delta(q, a)| \le 1$.
    \end{itemize}
  \end{defn}

  \begin{prop}
    Il n'existe pas de DBA $\mathcal{D}$ sur $\Sigma$ tel que 
    \[
    \mathcal{L}_\omega(\mathcal{D}) = \mathcal{L}_\omega\big((a+b)^\star \cdot b^\omega\big)
    .\]
    (C'est le langage du NBA $\mathcal{S}$ vu précédemment.)
  \end{prop}
  \begin{prv}
    Par l'absurde, soit $\mathcal{D}$ un DBA tel que $\mathcal{L}_\omega(\mathcal{D}) = \mathcal{L}_\omega((a+b)^\star \cdot b^\omega)$.
    On peut supposer $\mathcal{D}$ \textit{complet} :
    \[
    |Q_0| = 1 \quad\text{ et }\quad \forall q \in Q, \forall a \in \Sigma, |\delta(q, a)| = 1
    .\]
    (Il suffit d'ajouter un état puits.)

    On notera donc $\delta : Q \times \Sigma \to Q$ et $Q_0 = \{q_\iota\}$.
    On définit
    \begin{align*}
      \delta^\star: \Sigma^\star &\longrightarrow Q \\
       \varepsilon &\longmapsto q_\iota \\
       u \cdot a &\longmapsto \delta(\delta^\star(u), a)
    .\end{align*}
    On a que $b^\omega \in \mathcal{L}_\omega(\mathcal{D})$, il existe donc $n_0 \ge 0$ tel que $\delta^\star(b^{n_0}) \in F$.
    Puis, on a que $b^{n_0} a b^\omega \in \mathcal{L}_\omega(\mathcal{D})$,
    il existe donc $n_1 \ge 0$ tel que~$\delta^\star(b^{n_0} a b^{n_1}) \in F$.
    En itérant, il existe $(n_i)_{i \in \mathds{N}}$ tel que 
    \[
    \forall i \in \mathds{N}, \quad\delta^\star(b^{n_0} a b ^{n_1} a b ^{n_2} a \cdots a b^{n_i}) \in F
    .\]
    Considérons $\sigma = b^{n_0} a b^{n_1} a b^{n_2} a \cdots \in \Sigma^\omega$.
    Comme $\mathcal{D}$ est déterministe, on a que $\sigma \in \mathcal{L}_\omega(\mathcal{D})$, ce qui est absurde.
  \end{prv}

  On ne peut donc pas déterminiser un automate de Büchi (ce qui explique que le théorème de Büchi n'est pas aussi simple que pour les NFA).
  
  Il existe plusieurs familles d'automates déterministes sur les $\omega$-mots équivalents aux NBAs.

  Pour faire un DBA équivalent à $\mathcal{S}$, on doit changer le formalisme.

  \begin{figure}[H]
    \centering
    \begin{tikzpicture}
      \node[state,initial] (0) {0};
      \node[state,right of=0, accepting] (1) {1};

      \draw[->] (0) edge node{$b$} (1)
      (0) edge[loop above] node{$a,b$} (0)
      (1) edge[loop above] node{$b$} (1) ;
    \end{tikzpicture}
    \caption{Automate de Büchi non-déterministe $\mathcal{S}$}
  \end{figure}

  On peut par exemple considérer le DBA suivant et dire que l'on ne peut voire l'état 1 au plus un nombre fini de fois.

  \begin{figure}[H]
    \centering
    \begin{tikzpicture}
      \node[state,initial] (0) {0};
      \node[state,right of=0, accepting] (1) {1};

      \draw[->]
      (0) edge[bend left] node{$a$} (1)
      (1) edge[bend left] node{$b$} (0)
      (0) edge[loop above] node{$b$} (0)
      (1) edge[loop above] node{$a$} (1) ;
    \end{tikzpicture}
    \caption{Automate de Büchi non-déterministe $\bar{\mathcal{S}}$}
  \end{figure}

  Il existe plusieurs familles de conditions d'acceptation : Muller, Rabin, Street, Parité, \textit{etc}.
  Par exemple, pour Muller, un DBA est défini comme $(Q, \Sigma, \delta, q_\iota, \mathcal{T})$ où $\delta$ est déterministe et $\mathcal{T} \subseteq \wp(Q)$, et où $\rho \in Q^\omega$ est acceptant ssi $\{q  \mid \exists ^\infty t, \rho(t) = q\} \in \mathcal{T}$.

  \section{Automates de Büchi généralisés (GNBA).}

  L'objectif des GNBAs est pour la stabilité par intersection finies des expression $\omega$-régulières, et seront utiles pour passer de $\mathsf{LTL}$ à un NBA.

  \begin{defn}
    Un \textit{GNBA} est de la forme
    \[
    \mathcal{G} = (Q, \Sigma, \delta, Q_0, \mathcal{F})
    ,\]
    où $Q, \Sigma, \delta, Q_0$ sont définis comme pour les NBAs et où $\mathcal{F} \subseteq \wp(Q)$.

    Une exécution de $\mathcal{G}$ sur $\sigma \in \Sigma^\omega$ est \textit{acceptante} si
    \[
    \forall F \in \mathcal{F}, \quad \exists^\infty t \quad \rho(t) \in F
    .\]
    Le langage $\mathcal{L}_\omega(\mathcal{G})$ est 
    \[
    \mleft\{\,
    \sigma \in \Sigma^\omega\;\middle|\;
    \begin{array}{l}
      \text{il existe une exécution}\\
      \text{acceptante de $\mathcal{G}$ sur $\sigma$}
    \end{array}\,\mright\} 
    .\] 
  \end{defn}

  \begin{rmk}
    Soit $\mathcal{A} = (Q, \Sigma, \delta, Q_0, F)$ un NBA alors $\mathcal{G} = (Q, \Sigma, \delta, Q_0, \{F\})$ est un GNBA tel que $\mathcal{L}_\omega(\mathcal{G}) = \mathcal{L}_\omega(\mathcal{A})$.
  \end{rmk}

  \begin{lem}
    Soient $\mathcal{G}_1, \mathcal{G}_2$ deux GNBAs avec $\mathcal{G}_i = (Q_i, \Sigma, \delta_i, Q_{0,i}, \mathcal{F}_i)$.
    Alors, $\mathcal{L}_\omega(\mathcal{G}_1) \cap \mathcal{L}_\omega(\mathcal{G}_2) = \mathcal{L}_\omega(\mathcal{G})$ où 
    \[
    \mathcal{G} = (Q_1 \times Q_2, \delta, Q_{0,1} \times Q_{0,2}, \mathcal{F})
    \] 
    avec
    \begin{itemize}
      \item $\delta((q_1, q_2), a) = \mleft\{\,(q_1', q_2') \;\middle|\; 
        \begin{array}{l}
          q_1' \in \delta_1(q_1, a)\\
          q_2' \in \delta_2(q_2, a)\\
        \end{array}\,\mright\} $ ;
      \item $\mathcal{F} = \{F \times Q_2  \mid F \in \mathcal{F}_1\} \cup \{Q_1 \times F  \mid F \in \mathcal{F}_2\}$.
    \end{itemize}
    \qed
  \end{lem}

  \begin{thm}
    Soit $\mathcal{G} = (Q, \Sigma, \delta, Q_0, \mathcal{F})$ où $\mathcal{F} = \{F_0, \ldots, F_{k-1}\}$.
    Alors $\mathcal{L}_\omega(\mathcal{G}) = \mathcal{L}_\omega(\mathcal{A})$ où
    \[
    \mathcal{A} = (Q \times \{0,\ldots,k-1\}, \Sigma, \delta_\mathcal{A}, Q_0 \times \{0\}, F_0 \times \{0\})
    ,\] 
    avec
    \[
    \delta_\mathcal{A}((q, i), a) = \begin{cases}
      \{(q', i)  \mid q' \in \delta(q, a)\} & \text{ si }q \not\in F_i \\
      \{(q', i+1 \mod k)  \mid \delta' \in \delta(q, a)\}  & \text{ sinon}
    \end{cases}
    .\] 
  \end{thm}
  \begin{prv}
    \begin{itemize}
      \item Montrons $\mathcal{L}_\omega(\mathcal{A}) \subseteq \mathcal{L}_\omega(\mathcal{G})$.
        Soit $\sigma \in \mathcal{L}_\omega(\mathcal{A})$ et $\rho$ une exécution acceptante de $\sigma$ par $\mathcal{A}$.
        Soit $\rho \in Q^\omega$ une exécution de $\mathcal{G}$ sur $\sigma$ telle que $\rho = \pi_1 \circ \rho'$.
        Soit $t <t'$ tels que $\rho'(t) = \rho'(t') \in F_0 \times \{0\}$.
        Alors, $\rho'(t+1) \in Q \times \{1\}$ donc, il existe $t_1, \ldots, t_{k-1}$ tels que $\rho'(t_i) \in F_i \times \{i\}$ et $t < t_1 < t_2 < \cdots < t_{k-1} < t'$.
        Comme il existe une infinité de $t$ tels que $\rho(t) \in F_0 \times \{0\}$, on voit que $\rho$ est acceptante.
      \item Montrons $\mathcal{L}_\omega(\mathcal{G}) \subseteq \mathcal{L}_\omega(\mathcal{A})$.
        Soit $\sigma \in \mathcal{L}_\omega(\mathcal{G})$ et $\rho \in Q^\omega$ une exécution de $\sigma$ acceptante.
        Soit $\rho'$ une exécution de $\mathcal{A}$ sur~$\sigma$ telle que $\pi_1 \circ \rho' = \rho$.
        Supposons, par l'absurde, que pour un $i \in \{0, \ldots, k-1\}$ tel que $\forall^\infty t, \pi_2(\rho(t)) = i$.
        Alors $\forall^\infty t, \pi_2(\rho'(t)) \not\in F_i$.
        C'est impossible car $\exists ^\infty t, \rho(t) \in F_i$.
        Il s'en suit que $\rho'$ est acceptante.
    \end{itemize}
  \end{prv}

  \begin{crlr}
    Si $L$ et $K$ sont deux langages $\omega$-réguliers alors $L \cap K$ est $\omega$-régulier.
  \end{crlr}

  \section{Traduction de $\mathsf{LTL}$ en (G)NBA.}

  Soit $\mathrm{AP}$ \textit{\textbf{fini}} et $\phi$ une formule $\mathsf{LTL}$ sur $\mathrm{AP}$.
  On veut montrer que~$\llbracket \phi\rrbracket \subseteq (\mathbf{2}^\mathrm{AP})^\omega$ est $\omega$-régulier.
  Pour cela, on va construire un GNBA $\mathcal{G}$ tel que~$\mathcal{L}_\omega(\mathcal{G}) = \llbracket \phi\rrbracket$.

  \begin{rmk}[Idée]
    Soit $\sigma \in (\mathbf{2}^\mathrm{AP})^\omega$.
    On "voudrait" $\mathcal{G}$ tel que les exécutions $\rho$ de $\mathcal{G}$ sur $\sigma$ sont de la forme 
    \[
    i \mapsto \mleft\{\, \psi \;\middle|\; \sigma \upharpoonright i \in \llbracket \psi\rrbracket \,\mright\} 
    .\]
    Ceci n'est pas possible car on aurait une infinité d'états pour $\mathcal{G}$, ce que l'on ne peut pas avoir.
  \end{rmk}

  On suppose que $\mathsf{LTL}$ est défini par 
  \[
  \psi ::= \mathsf{a}  \mid \mathsf{True}  \mid \psi \land \psi  \mid \lnot \psi  \mid \nxt \psi  \mid \psi \until \psi
  \]
  (on retire les redondances du $\mathsf{LTL}$ "habituel").

  \begin{defn}
    On pose 
    \[
      \mathrm{cl}(\phi) = {}^{\displaystyle \{\psi, \lnot \psi  \mid \psi \text{ sous formule de } \phi\}}\big/_{\displaystyle\psi \text{ identifié avec } \lnot\lnot \psi}
    .\]
  \end{defn}

  Les états de $\mathcal{G}$ vont être certains $B \subseteq \mathrm{cl}(\phi)$.

  \begin{defn}
    On dit que $B \subseteq \mathrm{cl}(\phi)$ est \textit{maximal-consistant} si :
    \begin{itemize}
      \item  Si $\psi_1 \land \psi_2 \in \mathrm{cl}(\phi)$ alors $\psi_1 \land \psi_2 \in B$ ssi $\psi_1, \psi_2 \in B$.
      \item Si $\mathsf{True} \in \mathrm{cl}(\phi)$ alors $\mathsf{True} \in B$.
      \item Si $\psi \in \mathrm{cl}(\phi)$, alors $\lnot \psi \in B$ ssi $\psi \not\in B$.
    \end{itemize}

    On dit que $B \subseteq \mathrm{cl}(\phi)$ est \textit{localement consistant pour $\until$} si
    \begin{itemize}
      \item $\psi_2 \in B$ implique $\psi_1 \until \psi_2 \in B$ ;
      \item $\psi_1 \until \psi_2 \in B$ et $\psi_2 \not\in  B$ implique $\psi_1 \in B$.
    \end{itemize}
  \end{defn}

  \begin{defn}
    On pose \[
      \mathcal{G} = (Q, \mathbf{2}^\mathrm{AP}, \delta, Q_0, \mathcal{F})
    ,\] 
    où
    \begin{itemize}
      \item $Q = \mleft\{\,B \subseteq \mathrm{cl}(\phi) \;\middle|\;
        \begin{array}{l}
          \text{$B$ maximal-consistant}\\
          \text{$B$ localement consistant pour $\until$}
        \end{array}\,\mright\}$ ;
      \item $Q_0 = \{B \in Q  \mid \phi \in B\}$ ;
      \item $\delta : Q \times \mathbf{2}^\mathrm{AP} \to \wp(Q)$ est tel que $B' \in \delta(B, a)$ avec
        \begin{enumerate}
          \item $B \cap \mathrm{AP} = A \cap \mathrm{cl}(\phi)$,
          \item si $\nxt \psi \in \mathrm{cl}(\phi)$ alors $\nxt\psi \in B \iff\psi \in B'$,
          \item si $\psi_1 \until \psi_2 \in \mathrm{cl}(\phi)$ alors
            \[
              \psi_1 \until \psi_2 \in B \iff
              \begin{pmatrix} \psi_2 \in B \\
              \text{ou}\\
            \psi_1 \in B \text{ et } \psi_1 \until \psi_2 \in B'\end{pmatrix} 
            \;;\]
        \end{enumerate}
      \item $\mathcal{F} = \{F_{\psi_1 \until \psi_2}  \mid \psi_1 \until \psi_2 \in \mathrm{cl}(\phi)\}$
        où
        \[
        F_{\psi_1 \until \psi_2} = \big\{ B \in Q \:\big|\: \psi_1 \until \psi_2 \in B \implies \psi_2 \in B \big\} 
        .\]
    \end{itemize}
  \end{defn}

  \begin{thm}
    Avec cette définition, on a $\mathcal{L}_\omega(\mathcal{G}) = \llbracket \phi\rrbracket$.
  \end{thm}
  \begin{prv}
    \begin{itemize}
      \item Montrons que $\llbracket \phi\rrbracket  \subseteq \mathcal{L}_\omega(\mathcal{G})$.
        Soit $\sigma \in \llbracket \phi\rrbracket$ un mot.
        On définit~$\rho \in \wp(\mathrm{cl}(\phi))^\omega$ telle que 
        \[
        \rho(i) = \mleft\{\,\psi \in \mathrm{cl}(\phi) \;\middle|\; \sigma \upharpoonright i \in \llbracket \psi\rrbracket \,\mright\} 
        .\] 
        On voit que, pour tout $i \in \mathds{N}$, $\rho(i) \in Q$.
        On a que $\rho(0) \in Q_0$ car $\sigma \upharpoonright 0 = \sigma \in \llbracket \phi\rrbracket$.
        De plus, on a que $\rho(i+1) \in \delta(\rho(i), \sigma(i))$ (on vérifie aisément les trois propriétés sur $\delta$).
        On montre que $\rho \in Q^\omega$ est acceptante.
        Soit $\psi_1 \until \psi_2 \in \mathrm{cl}(\phi)$.
        Si $\forall^\infty t, \sigma \upharpoonright t \not\in \llbracket \psi_1 \until \psi_2\rrbracket$, alors $\forall^\infty t, (\psi_1 \until \psi_2) \not\in  \rho(t)$.
        Sinon, $\exists^\infty t, \sigma \upharpoonright t \in \llbracket \psi_1 \until \psi_2\rrbracket$.
        Soit $N \in \mathds{N}$. Il existe un certain $t \ge N$ tel que $\sigma \upharpoonright t \in \llbracket \psi_1 \until \psi_2\rrbracket$.
        Ainsi, il existe  $i$ tel que $\sigma \upharpoonright (t+i) \in \llbracket \psi_2\rrbracket$ et pour tout $j \in \{0, \ldots, i-1\}$, $\sigma \upharpoonright (t+j) \in \llbracket \psi_1\rrbracket$.
        Donc $\psi_2, \psi_1 \until \psi_2 \in \rho(t+i)$ et donc $\rho(t+i) \in F_{\psi_1 \until \psi_2}$.
        On en conclut que $\rho$ est acceptante.
      \item Montrons que $\mathcal{L}_\omega(\mathcal{G}) \subseteq \llbracket \phi\rrbracket$.
        Soit $\sigma \in \mathcal{L}_\omega(\mathcal{G})$ et $\rho$ une exécution acceptante de $\mathcal{G}$ sur $\sigma$.
        (On ne donne que l'idée pour cette partie de la preuve.)
        On va montrer que, pour tout $i \in \mathds{N}$,
        \[
        \rho(i) = \{\psi \in \mathrm{cl}(\phi)  \mid \sigma \upharpoonright i \in \llbracket \phi\rrbracket  \} 
        .\]
        On peut montrer par induction sur $\psi \in \mathrm{cl}(\phi)$ que, pour tout $\rho \in Q^\omega$ et pour tout $\sigma \in (\mathbf{2}^\mathrm{AP})^\omega$ tel que
        \begin{itemize}
          \item $\forall i, \rho(i+1) \in \delta(\rho(i), \sigma(i))$ ;
          \item $\forall F \in \mathcal{F}, \exists^\infty t, \rho(t) \in F$ ;
        \end{itemize}
        alors $\psi \in \rho(0) \iff \sigma \in \llbracket \psi\rrbracket$.
    \end{itemize}
  \end{prv}

  \begin{rmk}
    Le GNFA $\mathcal{G}$ a $\mathrm{O}(2^{|\phi|})$ états et $|\mathcal{F}| = \mathrm{O}(|\phi|)$.
    Donc, on a un NBA $\mathcal{A}$ tel que $\mathcal{L}_\omega(\mathcal{A}) = \llbracket \phi\rrbracket$ et $|Q_{\mathcal{A}}| = \mathrm{O}(2^{|\phi| + \log|\phi|})$.
  \end{rmk}

  \begin{rmk}
    Supposons que $|\mathrm{AP}| \ge 1$.
    Pour $n \in \mathds{N}$, le langage 
    \[
    L_n := \mleft\{\,A_1 \ldots A_n A_1 \ldots A_n \sigma \;\middle|\; \sigma \in (\mathbf{2}^\mathrm{AP})^\omega \,\mright\} 
    \] est la sémantique de la formule 
    \[
    \phi_n = \bigwedge_{\mathsf{a} \in \mathrm{AP}}
    \bigwedge_{1 \le i \le n} (\nxt^i \mathsf{a} \leftrightarrow \nxt^{n+i} \mathsf{a})
    ,\] et on a que $|\phi_n| = \mathrm{O}(n^2)$.
    Or, tout NBA $\mathcal{A}$ pour $L_n$ a ${|Q_{\mathcal{A}}| = \mathrm{O}(2^n)}$.
  \end{rmk}

  \begin{rmk}
    Soit $|\mathrm{AP}| \ge 1$ et $\mathsf{a} \in \mathrm{AP}$.
    Soit  \[
    L := \{\sigma \in (\mathbf{2}^\mathrm{AP})^\omega  \mid \forall i , a \in \sigma(2i)\} 
    .\] 
    On peut construire un NFA $\mathcal{A}$ tel que $L = \mathcal{L}_\omega(\mathcal{A})$.

    \begin{figure}[H]
      \centering
      \begin{tikzpicture}
        \node[state,initial, accepting] (0) {};
        \node[state,right of=0] (1) {};

        \draw[->] (0) edge[bend left] node{$\mathsf{a}$} (1)
        (1) edge[bend left] node{$\mathsf{True}$} (0) ;
      \end{tikzpicture}
      \caption{NBA sur l'alphabet $\mathbf{2}^\mathrm{AP}$}
    \end{figure}

    Le langage $L$ est le plus grand point fixe de $X = \mathsf{a} \land \nxt\nxt X$ qui n'est pas définissable en $\mathsf{LTL}$ (le $X$ doit être sous exactement un~$\nxt$ pour être définissable dans  $\mathsf{LTL}$ ).
    Il n'existe donc pas de formule~$\phi$ $\mathsf{LTL}$ telle que $\llbracket \phi\rrbracket = L$.
  \end{rmk}
\end{document}
